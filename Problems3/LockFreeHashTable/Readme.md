# Lock-free hash table via split-ordered list

Наша задача реализовать хеш-таблицу так, чтобы многопоточный доступ к ней был без задержек. И чтобы увеличение кол. ячеек тоже было быстро.

У нас есть теорминимум [тут](https://habr.com/ru/post/250383/) и [тут](https://habr.com/ru/post/250523/).

## Сборка под MinGW64

1. Перейти в папку с этим ридми, открыть там консоль.
2. Выполнить команды:
```
mkdir build
cd build
cmake .. -G "MinGW Makefiles"
mingw32-make.exe
```
3. Теперь у нас в папке build есть исполняемый файл с тестами.

## Тестирование

Я написал небольшой алгоритм для рандомизированного тестирования структуры данных.
Выполняется 100000 случайных операций по добавлению, удалению, проверке на наличие элемента.
Сравнение производим с обычным битовым полем.

## Описание SplitOrdered list



## Описание HashTable

Вот у нас есть обычный советский hash-map.
Его проблема в том, что при изменении размера таблицы - нужно перестраивать все с нуля.

![image](https://user-images.githubusercontent.com/25401699/205914735-97cea0cd-0ca1-438e-bf52-9737b659d897.png)

Это для однопоточной реализации сложно, ну а сделать это быстро для многопоточной сложно тем более.

Решение этой проблемы - split-ordered list - когда мы разбиваем уже существующий bucket на две части.

Давайте хранить таблицу в виде списка. У нас будет два типа элементов - sentinel, regular. Первые - для обозначения bucket - все, что идет после него и до следующего
sentinel - лежит в данном bucket. Вторые - сами элементы.

![image](https://user-images.githubusercontent.com/25401699/205920213-d92a0a25-b2c7-4237-8bc2-92c39215b75c.png)

Критерий сортировки такой - мы берем двоичное представление - переварачиваем, справа приписываем: sentinel - 0, regular - 1.
Получаем новые числа, по которым сортируем.

Теперь вставка и удаление очевидны.

### Вставка

![image](https://user-images.githubusercontent.com/25401699/205920772-13f7b91f-2135-4cde-8d3d-0c6b35c0e61d.png)

![image](https://user-images.githubusercontent.com/25401699/205920788-7a09b171-44c5-4928-9239-a31ebf5dbeb6.png)


