# Спинлоки

Мы хотим сделать критическую секцию.
Делаем с помощью циклов, чтобы пока один поток находится в критической секции - другие катались в цикле.

## TAS

Test and store

Самый простой вариант блокировки. У нас есть атомарная переменная. Поток смотрит - она единица или нет.
Если ноль, то поток идет дальше и ставит ее в 1. Если 1, то ждет в цикле.
При разблокировке поток ставит ее значение в 0.

## TTAS

test and test and set

Все аналогично предыдущему случаю, но мы знаем, что операция compare_exchange требуем доступа для чтения, то есть надо ждать.
А вот операция load - требует только чтения. Поэтому мы будет ждать в цикле, который только читает. А писать будет другой цикл.

## Spin lock

Нам выдают номерки. Как в гос учреждении. Есть две атомарные переменные - текущий номерок и последний выданный номерок.
Поток блокирует - ему выдают номерок равный последнему выданному. Он ждет, пока текущий не равен его номерку. И потом идет дальше.
При разблокировке мы текущий номер увеличиваем на 1.

![image](https://user-images.githubusercontent.com/25401699/202441339-47960e2c-ca94-4f85-9a5d-9c07c8fd0ce7.png)
